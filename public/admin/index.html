<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YT Video Summarizer - Admin Panel</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #0a0a0a;
      color: #ffffff;
      overflow-x: hidden;
    }

    /* Login Screen */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #000000 0%, #1a0000 50%, #000000 100%);
      position: relative;
      overflow: hidden;
    }

    .login-container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 0, 0, 0.1) 0%, transparent 70%);
      animation: pulse 15s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }

    .login-box {
      background: rgba(20, 20, 20, 0.95);
      border: 2px solid rgba(255, 0, 0, 0.3);
      border-radius: 20px;
      padding: 50px 40px;
      width: 100%;
      max-width: 420px;
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 60px rgba(255, 0, 0, 0.2);
      position: relative;
      z-index: 1;
    }

    .login-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .login-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      margin: 0 auto 20px;
      box-shadow: 0 10px 30px rgba(255, 0, 0, 0.3);
    }

    .login-title {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #ff0000 0%, #ffffff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }

    .login-subtitle {
      font-size: 14px;
      color: #888;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 10px;
    }

    .form-group input {
      width: 100%;
      padding: 14px 18px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      font-size: 15px;
      color: #ffffff;
      transition: all 0.3s;
    }

    .form-group input:focus {
      outline: none;
      border-color: #ff0000;
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.2);
    }

    .form-group input::placeholder {
      color: #666;
    }

    .btn-login {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 20px rgba(255, 0, 0, 0.3);
    }

    .btn-login:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(255, 0, 0, 0.4);
    }

    .btn-login:active {
      transform: translateY(0);
    }

    .error-message {
      background: rgba(255, 0, 0, 0.1);
      border: 1px solid rgba(255, 0, 0, 0.3);
      color: #ff4444;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 20px;
    }

    /* Admin Panel Layout */
    .admin-container {
      display: none;
      min-height: 100vh;
    }

    .admin-container.active {
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: linear-gradient(180deg, #0a0a0a 0%, #1a0505 100%);
      border-right: 1px solid rgba(255, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      left: 0;
      top: 0;
      z-index: 100;
    }

    .sidebar-header {
      padding: 30px 20px;
      border-bottom: 1px solid rgba(255, 0, 0, 0.2);
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sidebar-logo-icon {
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .sidebar-logo-text h1 {
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(135deg, #ff0000 0%, #ffffff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .sidebar-logo-text p {
      font-size: 12px;
      color: #666;
      margin-top: 2px;
    }

    .sidebar-nav {
      flex: 1;
      padding: 20px 0;
      overflow-y: auto;
    }

    .sidebar-nav::-webkit-scrollbar {
      width: 4px;
    }

    .sidebar-nav::-webkit-scrollbar-track {
      background: transparent;
    }

    .sidebar-nav::-webkit-scrollbar-thumb {
      background: rgba(255, 0, 0, 0.3);
      border-radius: 2px;
    }

    .nav-item {
      padding: 14px 20px;
      margin: 4px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 12px;
      color: #888;
      font-size: 15px;
      font-weight: 500;
    }

    .nav-item:hover {
      background: rgba(255, 0, 0, 0.1);
      color: #ffffff;
    }

    .nav-item.active {
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.2) 0%, rgba(255, 0, 0, 0.1) 100%);
      color: #ff0000;
    }

    .nav-icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    .sidebar-footer {
      padding: 20px;
      border-top: 1px solid rgba(255, 0, 0, 0.2);
    }

    .logout-btn {
      width: 100%;
      padding: 12px;
      background: rgba(255, 0, 0, 0.1);
      border: 1px solid rgba(255, 0, 0, 0.3);
      color: #ff4444;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .logout-btn:hover {
      background: rgba(255, 0, 0, 0.2);
      transform: translateY(-2px);
    }

    /* Main Content */
    .main-content {
      margin-left: 280px;
      width: calc(100% - 280px);
      min-height: 100vh;
    }

    /* Top Header */
    .top-header {
      background: rgba(15, 15, 15, 0.95);
      border-bottom: 1px solid rgba(255, 0, 0, 0.2);
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .header-title h2 {
      font-size: 24px;
      font-weight: 700;
      color: #ffffff;
    }

    .header-title p {
      font-size: 14px;
      color: #666;
      margin-top: 4px;
    }

    .header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .current-model-badge {
      padding: 10px 20px;
      background: rgba(255, 0, 0, 0.1);
      border: 1px solid rgba(255, 0, 0, 0.3);
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge-label {
      font-size: 12px;
      color: #888;
    }

    .badge-value {
      font-size: 14px;
      font-weight: 600;
      color: #ff0000;
    }

    /* Content Area */
    .content-area {
      padding: 30px;
    }

    .content-section {
      display: none;
    }

    .content-section.active {
      display: block;
    }

    .success-message {
      background: rgba(0, 255, 0, 0.1);
      border: 1px solid rgba(0, 255, 0, 0.3);
      color: #00ff00;
      padding: 12px;
      border-radius: 10px;
      font-size: 14px;
      margin-bottom: 20px;
    }

    /* Cards */
    .card {
      background: rgba(20, 20, 20, 0.8);
      border: 1px solid rgba(255, 0, 0, 0.2);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      backdrop-filter: blur(10px);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .card-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .card-title {
      flex: 1;
    }

    .card-title h3 {
      font-size: 18px;
      font-weight: 600;
      color: #ffffff;
    }

    .card-title p {
      font-size: 13px;
      color: #666;
      margin-top: 2px;
    }

    /* Models Grid */
    .models-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .model-card {
      background: rgba(30, 30, 30, 0.6);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }

    .model-card:hover {
      border-color: rgba(255, 0, 0, 0.5);
      transform: translateY(-4px);
      box-shadow: 0 10px 30px rgba(255, 0, 0, 0.2);
    }

    .model-card.selected {
      border-color: #ff0000;
      background: rgba(255, 0, 0, 0.1);
    }

    .model-name {
      font-size: 16px;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 4px;
    }

    .model-provider {
      font-size: 12px;
      color: #888;
      margin-bottom: 12px;
    }

    .model-description {
      font-size: 13px;
      color: #aaa;
      line-height: 1.5;
      margin-bottom: 16px;
    }

    .model-specs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .spec-badge {
      font-size: 11px;
      padding: 5px 10px;
      border-radius: 6px;
      font-weight: 600;
      background: rgba(255, 255, 255, 0.05);
      color: #aaa;
    }

    .select-btn {
      width: 100%;
      padding: 10px;
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .select-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
    }

    .select-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .selected-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #00ff00;
      color: #000;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
    }

    /* Custom Model Form */
    .custom-model-form {
      background: rgba(30, 30, 30, 0.6);
      border: 2px solid rgba(255, 0, 0, 0.2);
      border-radius: 12px;
      padding: 24px;
    }

    .custom-model-form h4 {
      font-size: 16px;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 8px;
    }

    .custom-model-form p {
      font-size: 13px;
      color: #888;
      margin-bottom: 16px;
    }

    .custom-input-group {
      display: flex;
      gap: 12px;
    }

    .custom-input-group input {
      flex: 1;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      font-size: 14px;
      color: #ffffff;
      font-family: 'Courier New', monospace;
    }

    .custom-input-group input:focus {
      outline: none;
      border-color: #ff0000;
      background: rgba(255, 255, 255, 0.08);
    }

    .custom-input-group button {
      padding: 12px 24px;
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .custom-input-group button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
    }

    /* Preset Tokens */
    .preset-token-card {
      background: rgba(30, 30, 30, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      transition: all 0.3s;
    }

    .preset-token-card:hover {
      border-color: rgba(255, 0, 0, 0.3);
      background: rgba(40, 40, 40, 0.6);
    }

    .preset-token-info {
      flex: 1;
    }

    .preset-token-name {
      font-size: 15px;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 4px;
    }

    .preset-token-id {
      font-size: 12px;
      color: #666;
      font-family: 'Courier New', monospace;
    }

    .preset-token-input-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .preset-token-input {
      width: 100px;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      color: #ffffff;
      text-align: center;
    }

    .preset-token-input:focus {
      outline: none;
      border-color: #ff0000;
    }

    .preset-token-btn {
      padding: 8px 16px;
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .preset-token-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
    }

    .save-all-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 20px;
    }

    .save-all-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(255, 0, 0, 0.4);
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 60px 20px;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-top-color: #ff0000;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading p {
      color: #666;
      font-size: 14px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 70px;
      }

      .sidebar-logo-text,
      .nav-item span,
      .sidebar-footer {
        display: none;
      }

      .main-content {
        margin-left: 70px;
        width: calc(100% - 70px);
      }

      .models-grid {
        grid-template-columns: 1fr;
      }

      .top-header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }

      .preset-token-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .preset-token-input-group {
        width: 100%;
      }

      .preset-token-input {
        flex: 1;
      }
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div class="login-container" id="loginContainer">
    <div class="login-box">
      <div class="login-header">
        <div class="login-icon">ü§ñ</div>
        <h1 class="login-title">YT Video Summarizer Admin</h1>
        <p class="login-subtitle">Secure Admin Access</p>
      </div>
      <div id="loginError"></div>
      <form id="loginForm">
        <div class="form-group">
          <label for="password">Enter Password</label>
          <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="current-password">
        </div>
        <button type="submit" class="btn-login">Access Admin Panel</button>
      </form>
    </div>
  </div>

  <!-- Admin Panel -->
  <div class="admin-container" id="adminContainer">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-text">
            <h1>YT Video Summarizer</h1>
            <p>Admin Panel</p>
          </div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-item active" data-section="models">
          <span class="nav-icon">üéØ</span>
          <span>AI Models</span>
        </div>
        <div class="nav-item" data-section="tokens">
          <span class="nav-icon">üìè</span>
          <span>Max Tokens</span>
        </div>
        <div class="nav-item" data-section="prompts">
          <span class="nav-icon">üí¨</span>
          <span>Prompt Management</span>
        </div>
      </nav>

      <div class="sidebar-footer">
        <button class="logout-btn" onclick="logout()">
          <span>üö™</span> Logout
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Top Header -->
      <div class="top-header">
        <div class="header-title">
          <h2 id="headerTitle">AI Model Management</h2>
          <p id="headerSubtitle">Configure AI models for all users</p>
        </div>
        <div class="header-actions">
          <div class="current-model-badge">
            <span class="badge-label">Active Model:</span>
            <span class="badge-value" id="currentModelName">Loading...</span>
          </div>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content-area">
        <div id="message"></div>

        <!-- AI Models Section -->
        <div class="content-section active" id="modelsSection">
          <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Loading AI models...</p>
          </div>

          <div id="modelsContainer" style="display: none;">
            <!-- Premium Models -->
            <div class="card">
              <div class="card-header">
                <div class="card-icon">‚≠ê</div>
                <div class="card-title">
                  <h3>Premium Models</h3>
                  <p>High-quality AI models with affordable pricing</p>
                </div>
              </div>
              <div class="models-grid" id="premiumModels"></div>
            </div>

            <!-- Free Models -->
            <div class="card">
              <div class="card-header">
                <div class="card-icon">üÜì</div>
                <div class="card-title">
                  <h3>Free Models</h3>
                  <p>Perfect for testing and development</p>
                </div>
              </div>
              <div class="models-grid" id="freeModels"></div>
            </div>

            <!-- Custom Model -->
            <div class="card">
              <div class="card-header">
                <div class="card-icon">üé®</div>
                <div class="card-title">
                  <h3>Custom Model</h3>
                  <p>Use any OpenRouter model ID</p>
                </div>
              </div>
              <div class="custom-model-form">
                <h4>Enter Custom Model ID</h4>
                <p>Browse available models at <a href="https://openrouter.ai/models" target="_blank" style="color: #ff0000; font-weight: 600;">openrouter.ai/models</a></p>
                <div class="custom-input-group">
                  <input type="text" id="customModelId" placeholder="provider/model-name" />
                  <button onclick="selectCustomModel()">Apply Model</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Max Tokens Section -->
        <div class="content-section" id="tokensSection">
          <div class="loading" id="maxTokensLoading">
            <div class="spinner"></div>
            <p>Loading max tokens configuration...</p>
          </div>

          <div id="maxTokensContainer" style="display: none;">
            <!-- Default Max Tokens -->
            <div class="card">
              <div class="card-header">
                <div class="card-icon">‚öôÔ∏è</div>
                <div class="card-title">
                  <h3>Default Max Tokens</h3>
                  <p>Applied to presets without specific configuration (100-10000)</p>
                </div>
              </div>
              <div class="custom-input-group">
                <input type="number" id="defaultMaxTokens" min="100" max="10000" placeholder="e.g., 4000" />
                <button onclick="updateDefaultMaxTokens()">Update Default</button>
              </div>
            </div>

            <!-- Preset-Specific Tokens -->
            <div class="card">
              <div class="card-header">
                <div class="card-icon">üìä</div>
                <div class="card-title">
                  <h3>Preset-Specific Max Tokens</h3>
                  <p>Configure max tokens for each preset individually</p>
                </div>
              </div>
              <div id="presetsMaxTokensList"></div>
              <button onclick="saveAllMaxTokens()" class="save-all-btn">üíæ Save All Changes</button>
            </div>
          </div>
        </div>

        <!-- Prompt Management Section -->
        <div class="content-section" id="promptsSection">
          <div class="loading" id="promptsLoading">
            <div class="spinner"></div>
            <p>Loading prompts...</p>
          </div>

          <div id="promptsContainer" style="display: none;">
            <!-- System Prompts List -->
            <div class="card">
              <div class="card-header">
                <div class="card-icon">ü§ñ</div>
                <div class="card-title">
                  <h3>System Prompts</h3>
                  <p>Manage all system prompts used throughout the application</p>
                </div>
              </div>
              <div id="promptsList"></div>
              <button onclick="saveAllPrompts()" class="save-all-btn">üíæ Save All Prompts</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let authToken = null;
    let currentModel = null;

    // Check for saved auth token
    const savedToken = localStorage.getItem('yugpt_admin_token');
    if (savedToken) {
      authToken = savedToken;
      showAdminPanel();
    }

    // Login form handler
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const password = document.getElementById('password').value;
      authToken = password;

      try {
        // Test authentication
        const response = await fetch('/api/admin/settings', {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });

        if (response.ok) {
          localStorage.setItem('yugpt_admin_token', authToken);
          showAdminPanel();
        } else {
          showError('loginError', 'Invalid password. Access denied.');
          authToken = null;
        }
      } catch (error) {
        showError('loginError', 'Connection failed. Check server.');
        authToken = null;
      }
    });

    async function showAdminPanel() {
      document.getElementById('loginContainer').style.display = 'none';
      document.getElementById('adminContainer').classList.add('active');
      await loadModels();
      await loadMaxTokens();
    }

    async function loadModels() {
      try {
        const response = await fetch('/api/admin/models', {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });

        if (!response.ok) throw new Error('Failed to load models');

        const data = await response.json();
        currentModel = data.data.currentModel;

        // Update current model display
        document.getElementById('currentModelName').textContent = currentModel;

        // Render models
        renderModels('premiumModels', data.data.models.paid || []);
        renderModels('freeModels', data.data.models.free || []);

        document.getElementById('loading').style.display = 'none';
        document.getElementById('modelsContainer').style.display = 'block';

      } catch (error) {
        console.error('Error loading models:', error);
        showMessage('Failed to load models. Refresh page.', 'error');
      }
    }

    function renderModels(containerId, models) {
      const container = document.getElementById(containerId);
      container.innerHTML = models.map(model => `
        <div class="model-card ${model.id === currentModel ? 'selected' : ''}" data-model-id="${model.id}">
          ${model.id === currentModel ? '<div class="selected-badge">‚úì ACTIVE</div>' : ''}
          <div class="model-name">${model.name}</div>
          <div class="model-provider">${model.provider}</div>
          <div class="model-description">${model.description}</div>
          <div class="model-specs">
            <span class="spec-badge">üìä ${model.contextLength}</span>
            <span class="spec-badge">üí∞ ${model.pricing}</span>
          </div>
          <button class="select-btn" onclick="selectModel('${model.id}')" ${model.id === currentModel ? 'disabled' : ''}>
            ${model.id === currentModel ? '‚úì Active' : 'Select Model'}
          </button>
        </div>
      `).join('');
    }

    async function selectModel(modelId) {
      try {
        showMessage('Updating model...', 'info');

        const response = await fetch('/api/admin/models/select', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ modelId })
        });

        if (!response.ok) throw new Error('Failed to select model');

        showMessage('‚úÖ Model updated! All users now use this model.', 'success');

        // Reload models to update UI
        setTimeout(() => {
          document.getElementById('loading').style.display = 'block';
          document.getElementById('modelsContainer').style.display = 'none';
          loadModels();
        }, 1500);

      } catch (error) {
        console.error('Error selecting model:', error);
        showMessage('‚ùå Failed to update model.', 'error');
      }
    }

    async function selectCustomModel() {
      const modelId = document.getElementById('customModelId').value.trim();

      if (!modelId) {
        showMessage('‚ùå Enter a model ID', 'error');
        return;
      }

      if (!modelId.includes('/')) {
        showMessage('‚ùå Invalid format. Use: provider/model-name', 'error');
        return;
      }

      await selectModel(modelId);
      document.getElementById('customModelId').value = '';
    }

    function showMessage(message, type) {
      const messageDiv = document.getElementById('message');
      messageDiv.innerHTML = `<div class="${type === 'error' ? 'error-message' : 'success-message'}">${message}</div>`;

      setTimeout(() => {
        messageDiv.innerHTML = '';
      }, 5000);
    }

    function showError(elementId, message) {
      const errorDiv = document.getElementById(elementId);
      errorDiv.innerHTML = `<div class="error-message">${message}</div>`;
    }

    function logout() {
      localStorage.removeItem('yugpt_admin_token');
      authToken = null;
      document.getElementById('adminContainer').classList.remove('active');
      document.getElementById('loginContainer').style.display = 'flex';
      document.getElementById('password').value = '';
      document.getElementById('loginError').innerHTML = '';
    }

    // Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', () => {
        const section = item.dataset.section;

        // Update nav active state
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');

        // Update content sections
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.getElementById(section + 'Section').classList.add('active');

        // Update header
        if (section === 'models') {
          document.getElementById('headerTitle').textContent = 'AI Model Management';
          document.getElementById('headerSubtitle').textContent = 'Configure AI models for all users';
        } else if (section === 'tokens') {
          document.getElementById('headerTitle').textContent = 'Max Tokens Configuration';
          document.getElementById('headerSubtitle').textContent = 'Control output length for each preset';
        } else if (section === 'prompts') {
          document.getElementById('headerTitle').textContent = 'Prompt Management';
          document.getElementById('headerSubtitle').textContent = 'Customize system prompts and templates';
        }
      });
    });

    // Max Tokens Management
    async function loadMaxTokens() {
      try {
        const response = await fetch('/api/admin/presets/max-tokens', {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });

        if (!response.ok) throw new Error('Failed to load max tokens');

        const data = await response.json();

        // Set default max tokens value
        document.getElementById('defaultMaxTokens').value = data.data.default;

        // Render preset cards
        renderPresetsMaxTokens(data.data.presets);

        // Hide loading, show content
        document.getElementById('maxTokensLoading').style.display = 'none';
        document.getElementById('maxTokensContainer').style.display = 'block';

      } catch (error) {
        console.error('Error loading max tokens:', error);
        document.getElementById('maxTokensLoading').innerHTML = '<p style="color: #ff4444;">Failed to load configuration</p>';
      }
    }

    function renderPresetsMaxTokens(presets) {
      const container = document.getElementById('presetsMaxTokensList');
      container.innerHTML = presets.map(preset => `
        <div class="preset-token-card">
          <div class="preset-token-info">
            <div class="preset-token-name">${preset.name}</div>
            <div class="preset-token-id">${preset.id}</div>
          </div>
          <div class="preset-token-input-group">
            <input
              type="number"
              id="preset-${preset.id}"
              value="${preset.maxTokens}"
              min="100"
              max="10000"
              class="preset-token-input"
            />
            <button onclick="updatePresetMaxTokens('${preset.id}')" class="preset-token-btn">Update</button>
          </div>
        </div>
      `).join('');
    }

    async function updateDefaultMaxTokens() {
      const maxTokens = parseInt(document.getElementById('defaultMaxTokens').value);

      if (!maxTokens || maxTokens < 100 || maxTokens > 10000) {
        showMessage('‚ùå Value must be 100-10000', 'error');
        return;
      }

      try {
        showMessage('Updating default...', 'info');

        const response = await fetch('/api/admin/presets/max-tokens/update-default', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ maxTokens })
        });

        if (!response.ok) throw new Error('Failed to update');

        showMessage(`‚úÖ Default updated to ${maxTokens}`, 'success');

      } catch (error) {
        console.error('Error:', error);
        showMessage('‚ùå Update failed', 'error');
      }
    }

    async function updatePresetMaxTokens(presetId) {
      const inputElement = document.getElementById(`preset-${presetId}`);
      const maxTokens = parseInt(inputElement.value);

      if (!maxTokens || maxTokens < 100 || maxTokens > 10000) {
        showMessage('‚ùå Value must be 100-10000', 'error');
        return;
      }

      try {
        showMessage('Updating preset...', 'info');

        const response = await fetch('/api/admin/presets/max-tokens/update', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ presetId, maxTokens })
        });

        if (!response.ok) throw new Error('Failed to update');

        showMessage(`‚úÖ Preset updated to ${maxTokens}`, 'success');

      } catch (error) {
        console.error('Error:', error);
        showMessage('‚ùå Update failed', 'error');
      }
    }

    async function saveAllMaxTokens() {
      try {
        showMessage('Saving all changes...', 'info');

        // Collect all preset values
        const presets = {};
        const inputs = document.querySelectorAll('.preset-token-input');

        let hasError = false;
        inputs.forEach(input => {
          const presetId = input.id.replace('preset-', '');
          const value = parseInt(input.value);

          if (!value || value < 100 || value > 10000) {
            showMessage(`‚ùå Invalid value for ${presetId}`, 'error');
            hasError = true;
            return;
          }

          presets[presetId] = value;
        });

        if (hasError) return;

        // Also update default if changed
        const defaultMaxTokens = parseInt(document.getElementById('defaultMaxTokens').value);
        if (!defaultMaxTokens || defaultMaxTokens < 100 || defaultMaxTokens > 10000) {
          showMessage('‚ùå Invalid default value', 'error');
          return;
        }

        // Bulk update presets
        const presetsResponse = await fetch('/api/admin/presets/max-tokens/bulk-update', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ presets })
        });

        if (!presetsResponse.ok) throw new Error('Failed to bulk update');

        // Update default
        const defaultResponse = await fetch('/api/admin/presets/max-tokens/update-default', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ maxTokens: defaultMaxTokens })
        });

        if (!defaultResponse.ok) throw new Error('Failed to update default');

        showMessage('‚úÖ All changes saved successfully!', 'success');

      } catch (error) {
        console.error('Error:', error);
        showMessage('‚ùå Failed to save changes', 'error');
      }
    }

    // Prompt Management
    async function loadPrompts() {
      try {
        const response = await fetch('/api/admin/prompts', {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });

        if (!response.ok) throw new Error('Failed to load prompts');

        const data = await response.json();
        const prompts = data.data.prompts;

        const promptsList = document.getElementById('promptsList');
        promptsList.innerHTML = '';

        prompts.forEach(prompt => {
          const promptCard = document.createElement('div');
          promptCard.className = 'preset-item';
          promptCard.style.marginBottom = '20px';
          promptCard.style.border = '1px solid rgba(255, 0, 0, 0.2)';
          promptCard.style.borderRadius = '8px';
          promptCard.style.padding = '16px';

          promptCard.innerHTML = `
            <div style="margin-bottom: 12px;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                <div style="flex: 1;">
                  <strong style="font-size: 16px; color: #ff0000;">${prompt.name}</strong>
                  <div style="font-size: 12px; color: #888; font-family: monospace; margin-top: 4px;">Key: ${prompt.key}</div>
                  <div style="font-size: 13px; color: #aaa; margin-top: 6px;">${prompt.description}</div>
                </div>
                <button onclick="resetPrompt('${prompt.key}')" class="secondary-btn" style="margin-left: 12px; padding: 6px 12px; font-size: 12px;">
                  üîÑ Reset
                </button>
              </div>
            </div>
            <div style="position: relative;">
              <textarea
                id="prompt-${prompt.key}"
                class="prompt-input"
                style="width: 100%; min-height: 200px; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.5; resize: vertical;"
                placeholder="Enter prompt content..."
              >${prompt.content}</textarea>
              <div style="font-size: 11px; color: #666; margin-top: 6px; display: flex; justify-content: space-between;">
                <span>Characters: ${prompt.length}</span>
                <span>Variables: {{VARIABLE_NAME}}</span>
              </div>
            </div>
          `;

          promptsList.appendChild(promptCard);
        });

        document.getElementById('promptsLoading').style.display = 'none';
        document.getElementById('promptsContainer').style.display = 'block';

      } catch (error) {
        console.error('Error loading prompts:', error);
        showMessage('‚ùå Failed to load prompts', 'error');
        document.getElementById('promptsLoading').style.display = 'none';
      }
    }

    async function saveAllPrompts() {
      try {
        showMessage('Saving all prompts...', 'info');

        const prompts = {};
        const textareas = document.querySelectorAll('.prompt-input');

        let hasError = false;
        textareas.forEach(textarea => {
          const promptKey = textarea.id.replace('prompt-', '');
          const content = textarea.value.trim();

          if (!content) {
            showMessage(`‚ùå Prompt '${promptKey}' cannot be empty`, 'error');
            hasError = true;
            return;
          }

          prompts[promptKey] = content;
        });

        if (hasError) return;

        const response = await fetch('/api/admin/prompts/bulk-update', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ prompts })
        });

        if (!response.ok) throw new Error('Failed to save prompts');

        showMessage('‚úÖ All prompts saved successfully!', 'success');

      } catch (error) {
        console.error('Error:', error);
        showMessage('‚ùå Failed to save prompts', 'error');
      }
    }

    async function resetPrompt(promptKey) {
      if (!confirm(`Are you sure you want to reset '${promptKey}' to its default value?`)) {
        return;
      }

      try {
        showMessage(`Resetting ${promptKey}...`, 'info');

        const response = await fetch('/api/admin/prompts/reset', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ promptKey })
        });

        if (!response.ok) throw new Error('Failed to reset prompt');

        showMessage('‚úÖ Prompt reset successfully!', 'success');

        // Reload prompts to show the reset value
        await loadPrompts();

      } catch (error) {
        console.error('Error:', error);
        showMessage('‚ùå Failed to reset prompt', 'error');
      }
    }

    // Load prompts when admin panel loads
    if (savedToken) {
      loadPrompts();
    }
  </script>
</body>
</html>
